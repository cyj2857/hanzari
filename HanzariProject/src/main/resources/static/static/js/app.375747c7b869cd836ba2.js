webpackJsonp([1],{0:function(e,t){},1:function(e,t){},2:function(e,t){},"7zck":function(e,t){},NHnr:function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=o("7+uW"),l=o("mtWM"),r=o.n(l),s=o("d7EF"),n=o.n(s),i=o("mvHQ"),c=o.n(i),h=o("ifoU"),d=o.n(h),p=o("Xxa5"),m=o.n(p),u=o("exGp"),f=o.n(u),v={name:"MappingEmployee",props:["copyFromManageSeatsEmployeeList"],data:function(){return{employeeList:this.copyFromManageSeatsEmployeeList,search:"",headers:[{text:"이름",align:"start",sortable:!0,value:"name"},{text:"부서",value:"department"},{text:"내선번호",value:"number"},{text:"",value:"mappingEmployeeToVacantButton"}],allEmployeeSeatMap:null}},created:function(){var e=this;J.$on("pushEachEmployeeSeatMap",function(t){e.allEmployeeSeatMap=t})},beforeDestroy:function(){J.$off("pushEachEmployeeSeatMap")},methods:{clickEmployeeToMapping:function(e){J.$emit("mappingEmployeeToVacant",e)},changeBackPage:function(){J.$emit("pushMappingEmployeeComponentStatus",!1)}}},g={render:function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("v-card",{attrs:{flat:"",color:"transparent"}},[o("v-icon",{staticStyle:{float:"right"},attrs:{large:""},on:{click:e.changeBackPage}},[e._v("clear")]),e._v(" "),o("v-card-title",[o("v-text-field",{attrs:{"append-icon":"mdi-magnify",label:"이름/부서/내선번호 중 입력하세요. 예) 마효리, 부서1, 111-0001","single-line":"","hide-details":""},model:{value:e.search,callback:function(t){e.search=t},expression:"search"}})],1),e._v(" "),o("v-data-table",{staticClass:"elevation-1",attrs:{headers:e.headers,items:this.employeeList,search:e.search,height:"400px","no-data-text":"데이터가 없습니다","footer-props":{"items-per-page-text":"페이지 당 사원수","items-per-page-options":[5,10]}},scopedSlots:e._u([{key:"item",fn:function(t){return[o("tr",[o("td",[e._v(e._s(t.item.name))]),e._v(" "),o("td",[e._v(e._s(t.item.department))]),e._v(" "),o("td",[e._v(e._s(t.item.number))]),e._v(" "),o("td",[o("v-icon",{attrs:{large:"",id:"mappingEmployeeToVacantButton"},on:{click:function(o){return e.clickEmployeeToMapping(t.item)}}},[e._v("add_box")])],1)])]}},{key:"pageText",fn:function(t){return[e._v("\n      ITEMS "+e._s(t.pageStart)+" - "+e._s(t.pageStop)+" OF\n      "+e._s(t.itemsLength)+"\n    ")]}}])})],1)},staticRenderFns:[]},F=o("VU/8")(v,g,!1,null,null,null).exports,y={name:"ManageSeats",props:["copyFromTabsEmployeeList","copyFromTabsFloorList"],components:{MappingEmployee:F},data:function(){return{employee:this.copyFromTabsEmployeeList,mappingEmployeeComponentStatus:!1,floorItems:[],selectedFloorItemsId:null,addVacantSwitchStatus:!1,allFloorList:this.copyFromTabsFloorList,currentSelectedFloorObject:null}},created:function(){var e=this;if(this.copyFromTabsFloorList&&this.copyFromTabsFloorList.length){this.currentSelectedFloorObject=this.allFloorList[this.allFloorList.length-1];for(var t=0;t<this.copyFromTabsFloorList.length;t++)this.currentSelectedFloorObject.floorId!==this.copyFromTabsFloorList[t].floorId&&this.floorItems.push(this.copyFromTabsFloorList[t])}J.$on("allFloorList",function(t){e.allFloorList=t,e.initFloorItems()}),J.$on("pushSelectedFloorObject",function(t){e.currentSelectedFloorObject=t,e.initFloorItems()}),J.$on("pushMappingEmployeeComponentStatus",function(t){e.mappingEmployeeComponentStatus=t})},beforeDestroy:function(){J.$off("allFloorList"),J.$off("pushSelectedFloorObject"),J.$off("pushMappingEmployeeComponentStatus")},methods:{initFloorItems:function(){this.floorItems=[];for(var e=0;e<this.allFloorList.length;e++)this.currentSelectedFloorObject.floorId!==this.allFloorList[e].floorId&&this.floorItems.push(this.allFloorList[e])},changeFloorSeat:function(){this.selectedFloorItemsId?J.$emit("moveSeatToAnotherFloor",this.selectedFloorItemsId):alert("이동할 층을 선택하지 않았습니다.")},getMappingEmployeeComponent:function(){this.mappingEmployeeComponentStatus=!0},changeAddVacantSwitchStatus:function(){J.$emit("pushAddVacantSwitchStatus",this.addVacantSwitchStatus)},clickChangeSeatToVacant:function(){J.$emit("changeSeatToVacant")}}},S={render:function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",[e.mappingEmployeeComponentStatus?e._e():o("v-card",{attrs:{flat:"",color:"transparent"}},[o("v-row",[o("v-col",{attrs:{cols:"12",sm:"9"}},[o("v-card-title",[o("v-icon",{attrs:{large:""}},[e._v("event_seat")]),e._v(" "),o("h3",[e._v("좌석 만들기")])],1)],1),e._v(" "),o("v-col",{attrs:{cols:"12",sm:"3"}},[o("v-switch",{attrs:{inset:""},on:{change:e.changeAddVacantSwitchStatus},model:{value:e.addVacantSwitchStatus,callback:function(t){e.addVacantSwitchStatus=t},expression:"addVacantSwitchStatus"}})],1)],1),e._v(" "),o("v-row",[o("v-col",{attrs:{cols:"10",sm:"6"}},[o("v-card-text",[o("v-btn",{attrs:{color:"blue lighten-3"},on:{click:e.getMappingEmployeeComponent}},[o("h4",[o("v-icon",{attrs:{large:""}},[e._v("perm_identity")]),e._v("사원 매핑하기")],1)])],1)],1),e._v(" "),o("v-col",{attrs:{cols:"10",sm:"4"}},[o("v-card-text",[o("v-btn",{attrs:{color:"pink lighten-3"},on:{click:e.clickChangeSeatToVacant}},[o("h4",[o("v-icon",{attrs:{large:""}},[e._v("person_add_disabled")]),e._v("자리 비우기\n            ")],1)])],1)],1)],1),e._v(" "),o("v-divider",{staticClass:"mx-4"}),e._v(" "),o("v-card-title",[o("v-icon",{attrs:{large:""}},[e._v("stairs")]),e._v(" "),o("h3",[e._v("층간 이동하기")])],1),e._v(" "),o("v-row",[o("v-col",{attrs:{cols:"9"}},[o("v-select",{attrs:{items:e.floorItems,"item-value":"floorId","item-text":"floorName",chips:"",label:"층을 선택하세요","single-line":"",outlined:"",dense:"","no-data-text":"이동할 층이 없습니다."},model:{value:e.selectedFloorItemsId,callback:function(t){e.selectedFloorItemsId=t},expression:"selectedFloorItemsId"}})],1),e._v(" "),o("v-col",{attrs:{cols:"12",sm:"3"}},[o("v-icon",{attrs:{large:""},on:{click:e.changeFloorSeat}},[e._v("edit")])],1)],1)],1),e._v(" "),e.mappingEmployeeComponentStatus&&e.employee?o("MappingEmployee",{attrs:{copyFromManageSeatsEmployeeList:e.employee}}):e._e()],1)},staticRenderFns:[]},b=o("VU/8")(y,S,!1,null,null,null).exports,I=o("pFYg"),L=o.n(I),x=o("c/Tr"),M=o.n(x),_=(o("gJtD"),{props:["copyFromTabsFloorList","copyFromTabsLatestFloorImage","copyFromTabsOtherFloorsImageList"],data:function(){return{length:null,allFloorList:[],managerFloorList:[],currentSelectedFloorObject:null,clickFloorIndexes:null,allImageMap:null,currentFloorImageName:"이미지를 업로드하세요",allSeatMap:null,toolTipText:null}},created:function(){var e=this;if(this.copyFromTabsFloorList&&this.copyFromTabsFloorList.length&&(this.currentSelectedFloorObject=this.copyFromTabsFloorList[this.copyFromTabsFloorList.length-1],this.allFloorList=this.copyFromTabsFloorList,this.managerFloorList=this.allFloorList.slice(),this.length=this.copyFromTabsFloorList.length,this.clickFloorIndexes=this.currentSelectedFloorObject.floorId),null==this.allImageMap){if(this.allImageMap=new d.a,this.copyFromTabsLatestFloorImage)for(var t=0;t<this.copyFromTabsLatestFloorImage.length;t++){var o=this.copyFromTabsLatestFloorImage[t].url,a=this.copyFromTabsLatestFloorImage[t].floorId;this.allImageMap.set(a,o)}if(this.copyFromTabsOtherFloorsImageList)for(var l=0;l<this.copyFromTabsOtherFloorsImageList.length;l++){var r=this.copyFromTabsOtherFloorsImageList[l].url,s=this.copyFromTabsOtherFloorsImageList[l].floorId;this.allImageMap.set(s,r)}}J.$on("pushAllSeatMap",function(t){e.allSeatMap=t}),J.$on("pushFloorOfSeat",function(t){for(var o=0;o<e.allFloorList.length;o++)t===e.allFloorList[o].floorId&&e.clickFloor(e.allFloorList[o])})},beforeDestroy:function(){J.$off("pushAllSeatMap"),J.$off("pushFloorOfSeat")},methods:{showToolTip:function(e){if(this.allSeatMap)if(this.allSeatMap.get(e.floorId))if(this.allSeatMap.get(e.floorId).length){var t=this.allSeatMap.get(e.floorId),o=t.length,a=null,l=new d.a;if(o){for(var r=0;r<t.length;r++)if(null==t[r].employeeId)a++;else{if(!l.get(t[r].employeeDepartment)){l.set(t[r].employeeDepartment,[])}l.get(t[r].employeeDepartment).push(t[r].employeeId)}var s;s=M()(l.keys());for(var n="<br>",i=0;i<s.length;i++)n+=s[i]+" : "+l.get(s[i]).length+"<br>";this.toolTipText=e.floorName+"층 <br>전체 좌석 : "+o+"<br> 공석 : "+a+n}}else this.toolTipText=e.floorName+"층 <br>좌석이 없습니다.";else this.toolTipText=e.floorName+"층 <br>좌석이 없습니다.";else this.toolTipText=e.floorName+"층 <br>좌석이 없습니다."},clickFloor:function(e){this.clickFloorIndexes=[],this.clickFloorIndexes.push(e.floorId),this.allImageMap.get(e.floorId)?this.currentFloorImageName=this.allImageMap.get(e.floorId).name:this.currentFloorImageName="이미지를 업로드하세요",this.currentSelectedFloorObject=e,J.$emit("pushSelectedFloorObject",e)},createFloorUUID:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)})},addFloor:function(){var e={};e.floorId=this.createFloorUUID(),e.floorName="",e.buildingId="HANCOM01",e.floorOrder=this.allFloorList.length,e.create=!0,e.modify=!1,e.delete=!1,this.allFloorList.push(e),this.managerFloorList.push(e),this.currentSelectedFloorObject=e,this.clickFloorIndexes=[],this.clickFloorIndexes.push(this.currentSelectedFloorObject.floorId),this.length++,J.$emit("pushSelectedFloorObject",this.currentSelectedFloorObject);var t=this.allFloorList.slice();J.$emit("pushAllFloorList",t);var o=this.managerFloorList.slice();J.$emit("pushManagerFloorList",o)},editFloorName:function(){var e=this,t=this.allFloorList.findIndex(function(t){return t.floorId===e.currentSelectedFloorObject.floorId});this.allFloorList[t].modify=!0,this.managerFloorList[t].modify=!0,J.$emit("pushChangedFloorName",this.currentSelectedFloorObject.floorName);var o=this.allFloorList.slice();J.$emit("pushAllFloorList",o);var a=this.managerFloorList.slice();J.$emit("pushManagerFloorList",a)},removeFloor:function(){if(this.length>0){var e=this.currentSelectedFloorObject.floorId,t=this.allFloorList.findIndex(function(t){return t.floorId===e});if(t>-1){J.$emit("pushDeletedFloorId",this.allFloorList[t].floorId),this.allFloorList.splice(t,1),this.managerFloorList[t].delete=!0;var o=null;console.log(void 0===t?"undefined":L()(t)),console.log(L()(0)),o=0===t?t:t-1,J.$emit("pushSelectedFloorObject",this.allFloorList[o]);var a=this.allFloorList.slice();J.$emit("pushAllFloorList",a);var l=this.managerFloorList.slice();J.$emit("pushManagerFloorList",l),this.currentSelectedFloorObject=this.allFloorList[o]}this.length--,this.length>0&&(this.clickFloorIndexes=[],this.clickFloorIndexes.push(this.currentSelectedFloorObject.floorId))}else alert("there are no seats to delete!")},changeImageFile:function(e){var t=e.target.files||e.dataTransfer.files;t.length&&this.saveImageFile(t[0])},saveImageFile:function(e){this.allImageMap.set(this.currentSelectedFloorObject.floorId,e),this.currentFloorImageName=this.allImageMap.get(this.currentSelectedFloorObject.floorId).name,J.$emit("pushAllImageMap",this.allImageMap)}}}),C={render:function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",[o("v-card",{attrs:{flat:"",color:"transparent"}},[o("v-row",[o("v-col",{attrs:{cols:"12",sm:"8"}},[o("v-card-title",[o("v-icon",{attrs:{large:""}},[e._v("stairs")]),e._v(" "),o("h3",[e._v("층 설정")])],1)],1),o("v-col",{attrs:{cols:"12",sm:"4"}},[o("v-btn",{attrs:{small:""}},[o("v-icon",{attrs:{medium:"",dark:""},on:{click:e.removeFloor}},[e._v("remove_circle")])],1),e._v(" "),o("v-btn",{attrs:{small:""}},[o("v-icon",{attrs:{medium:"",dark:""},on:{click:e.addFloor}},[e._v("add_circle")])],1)],1)],1),e._v(" "),o("v-row",{staticStyle:{"overflow-y":"scroll",height:"180px"}},e._l(this.allFloorList,function(t){return o("v-col",{key:t.floorId,staticClass:"d-flex child-flex",attrs:{cols:"4"}},[o("v-tooltip",{attrs:{bottom:""},scopedSlots:e._u([{key:"activator",fn:function(a){var l=a.on;return[o("v-btn",e._g({style:{border:e.clickFloorIndexes.includes(t.floorId)?"thick solid black":""},attrs:{large:""},on:{click:function(o){return e.clickFloor(t)},mouseover:function(o){return e.showToolTip(t)}}},l),[o("h3",[e._v(e._s(t.floorName))])])]}}],null,!0)},[e._v(" "),o("span",{domProps:{innerHTML:e._s(e.toolTipText)}})])],1)}),1),e._v(" "),o("v-divider",{staticClass:"mx-4"}),e._v(" "),o("v-card-title",[o("v-icon",{attrs:{large:""}},[e._v("stairs")]),e._v(" "),o("h3",[e._v("층 이름 편집")])],1),e._v(" "),e.currentSelectedFloorObject?o("v-row",[o("v-col",{attrs:{cols:"12",sm:"9"}},[o("v-text-field",{attrs:{label:"층 이름을 입력하세요",solo:""},on:{keyup:e.editFloorName},model:{value:e.currentSelectedFloorObject.floorName,callback:function(t){e.$set(e.currentSelectedFloorObject,"floorName",t)},expression:"currentSelectedFloorObject.floorName"}})],1),e._v(" "),o("v-col",{attrs:{cols:"12",sm:"3"}},[o("v-card-text",[o("h2",[e._v("층")])])],1)],1):e._e(),e._v(" "),o("v-divider",{staticClass:"mx-4"}),e._v(" "),o("v-card-title",[o("v-icon",{attrs:{large:""}},[e._v("image")]),e._v(" "),o("h3",[e._v("배경화면 설정")])],1),e._v(" "),o("v-row",[o("v-col",{attrs:{cols:"12",sm:"9"}},[o("v-card",[o("v-card-text",[e._v(e._s(e.currentFloorImageName))])],1)],1),e._v(" "),o("v-col",{attrs:{cols:"12",sm:"3"}},[o("v-card-text",[o("input",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],ref:"Upload",attrs:{type:"file"},on:{change:e.changeImageFile}}),e._v(" "),o("v-btn",{attrs:{color:"blue-grey lighten-2"},on:{click:function(t){return e.$refs.Upload.click()}}},[o("h4",[e._v("업로드")])])],1)],1)],1)],1)],1)},staticRenderFns:[]},E={name:"ManageSearch",props:["eachEmployeeSeatMap"],data:function(){return{allEmployeeSeat:[],allEmployeeSeatMap:this.eachEmployeeSeatMap,search:"",headers:[{text:"이름",align:"start",sortable:!0,value:"name"},{text:"부서",value:"department"},{text:"내선번호",value:"number"},{text:"",value:"showSeatButton"}]}},created:function(){var e=this;J.$on("pushEachEmployeeSeatMap",function(t){e.allEmployeeSeatMap=t,e.getAllEmployeeSeats()})},mounted:function(){this.getAllEmployeeSeats()},beforeDestroy:function(){J.$off("pushEachEmployeeSeatMap")},methods:{getAllEmployeeSeats:function(){if(this.allEmployeeSeatMap){this.allEmployeeSeat=[];var e;e=M()(this.allEmployeeSeatMap.keys());for(var t=0;t<e.length;t++){var o;o=this.allEmployeeSeatMap.get(e[t]);for(var a=0;a<o.length;a++){var l={};null!=o[a].employeeId&&(l.seatId=o[a].seatId,l.employeeId=o[a].employeeId,l.name=o[a].employeeName,l.department=o[a].employeeDepartment,l.floorId=o[a].floorId,l.number=o[a].employeeNumber,this.allEmployeeSeat.push(l))}}}},showSeatButtonClicked:function(e){J.$emit("showSeatHighlight",e),J.$emit("pushFloorOfSeat",e.floorId)}}},w={render:function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("v-card",{attrs:{flat:"",color:"transparent"}},[o("v-card-title",[o("v-text-field",{attrs:{"append-icon":"mdi-magnify",label:"이름/부서/내선번호 중 입력하세요. 예) 마효리, 부서1, 111-0001","single-line":"","hide-details":""},model:{value:e.search,callback:function(t){e.search=t},expression:"search"}})],1),e._v(" "),o("v-data-table",{staticClass:"elevation-1",attrs:{headers:e.headers,items:e.allEmployeeSeat,search:e.search,height:"400px","no-data-text":"데이터가 없습니다","footer-props":{"items-per-page-text":"페이지 당 자리수","items-per-page-options":[5,10]}},scopedSlots:e._u([{key:"item",fn:function(t){return[o("tr",[o("td",[e._v(e._s(t.item.name))]),e._v(" "),o("td",[e._v(e._s(t.item.department))]),e._v(" "),o("td",[e._v(e._s(t.item.number))]),e._v(" "),o("td",[o("v-icon",{attrs:{large:"",id:"showSeatButton"},on:{click:function(o){return e.showSeatButtonClicked(t.item)}}},[e._v("event_seat")])],1)])]}}])})],1)},staticRenderFns:[]},k={props:["copyEmployeeList","copyFloorList","copyLatestFloorImage","copyOtherFloorsImageList"],components:{ManageSeats:b,ManageFloors:o("VU/8")(_,C,!1,null,null,null).exports,ManageSearch:o("VU/8")(E,w,!1,null,null,null).exports},data:function(){return{tab:null,employeeList:this.copyEmployeeList,floors:this.copyFloorList,eachEmployeeSeatMap:null,latestFloorImage:this.copyLatestFloorImage,otherFloorsImageList:this.copyOtherFloorsImageList,items:[{icon:"stairs",title:"층 설정",index:0,content:"ManageFloors"},{icon:"event_seat",title:"좌석 설정",index:1,content:"ManageSeats"},{icon:"search",index:2,title:"검색",content:"ManageSearch"}]}},created:function(){var e=this;J.$on("pushEachEmployeeSeatMap",function(t){e.eachEmployeeSeatMap=t})},beforeDestroy:function(){J.$off("pushEachEmployeeSeatMap")}},O={render:function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",[o("v-toolbar",{attrs:{color:"black",dark:""}}),e._v(" "),o("v-tabs",{attrs:{"background-color":"black",dark:"",height:"65",horizontal:"",grow:""},model:{value:e.tab,callback:function(t){e.tab=t},expression:"tab"}},[o("v-tabs-slider",{attrs:{color:"blue"}}),e._v(" "),e._l(e.items,function(t){return o("v-tab",{key:t.index},[o("v-icon",{attrs:{large:"",dark:""}},[e._v(e._s(t.icon))])],1)})],2),e._v(" "),o("v-tabs-items",{model:{value:e.tab,callback:function(t){e.tab=t},expression:"tab"}},e._l(e.items,function(t){return o("v-tab-item",{key:t.index},[o("v-card",{attrs:{flat:""}},[o("v-card-text",[o(t.content,{tag:"component",attrs:{copyFromTabsEmployeeList:e.employeeList,copyFromTabsFloorList:e.floors,eachEmployeeSeatMap:e.eachEmployeeSeatMap,copyFromTabsLatestFloorImage:e.latestFloorImage,copyFromTabsOtherFloorsImageList:e.otherFloorsImageList}})],1)],1)],1)}),1)],1)},staticRenderFns:[]},T={name:"AttachCanvas",props:["copyEmployeeList","copyFloorList","copyLatestFloorImage","copyOtherFloorsImageList","copyLatestFloorSeatList","copyOtherFloorsSeatMap"],data:function(){return{floorCanvas:null,zoom:1,fontSize:25,clipboard:null,currentSelectedFloorName:null,currentSelectedFloorId:null,latestFloorImageFromDb:this.copyLatestFloorImage,otherFloorImageFromDb:this.copyOtherFloorsImageList,allImageMap:null,latestFloorSeatListFromDb:this.copyLatestFloorSeatList,otherFloorSeatListFromDb:this.copyOtherFloorsSeatMap,allSeatMap:null,managerAllSeatMap:null,employeeList:this.copyEmployeeList,eachEmployeeSeatMap:null,allFloorList:this.copyFloorList,managerFloorList:this.copyFloorList,contextMenuStatus:!1,contextMenuXLocation:100,contextMenuYLocation:100,contextMenuItems:[{title:"삭제하기",index:0},{title:"복제하기",index:1}],toolTipStatus:!1,toolTipXLocation:100,toolTipYLocation:100,toolTipColor:null,toolTipText:null,addVacantSwitchStatus:!1,seatNumber:0,firstMouseDownX:0,firstMouseDownY:0}},created:function(){var e=this;this.allFloorList&&this.allFloorList.length&&(this.currentSelectedFloorName=this.allFloorList[this.allFloorList.length-1].floorName,this.currentSelectedFloorId=this.allFloorList[this.allFloorList.length-1].floorId),null==this.allImageMap&&(this.allImageMap=new d.a),null==this.allSeatMap&&(this.allSeatMap=new d.a),null==this.managerAllSeatMap&&(this.managerAllSeatMap=new d.a),null==this.eachEmployeeSeatMap&&(this.eachEmployeeSeatMap=new d.a),J.$on("pushSelectedFloorObject",function(t){t?(e.currentSelectedFloorId=t.floorId,e.currentSelectedFloorName=t.floorName,e.changeFloor()):(e.currentSelectedFloorId=null,e.currentSelectedFloorName=null,e.floorCanvas.backgroundImage=0,e.floorCanvas.backgroundColor="aliceblue",e.floorCanvas.getObjects().forEach(function(t){e.floorCanvas.remove(t)}))}),J.$on("pushChangedFloorName",function(t){e.currentSelectedFloorName=t}),J.$on("pushAddVacantSwitchStatus",function(t){e.addVacantSwitchStatus=t}),J.$on("mappingEmployeeToVacant",function(t){e.mappingEmployeeToVacant(t)}),J.$on("moveSeatToAnotherFloor",function(t){e.moveSeatToAnotherFloor(t)}),J.$on("changeSeatToVacant",function(){e.floorCanvas.getActiveObject()?e.changeSeatToVacant():alert("there is no selected object")}),J.$on("pushAllFloorList",function(t){e.allFloorList=t,console.log(e.allFloorList)}),J.$on("pushManagerFloorList",function(t){e.managerFloorList=t,console.log(e.managerFloorList)}),J.$on("pushAllImageMap",function(t){e.allImageMap=t,e.loadImageFile(e.allImageMap.get(e.currentSelectedFloorId))}),J.$on("showSeatHighlight",function(t){e.showSeatHighlight(t)}),J.$on("pushDeletedFloorId",function(t){e.allSeatMap.delete(t),e.managerAllSeatMap.delete(t)})},mounted:function(){this.initializing(),this.loadLatestFloor()},beforeDestroy:function(){J.$off("moveSeatToAnotherFloor"),J.$off("pushSelectedFloor"),J.$off("pushChangedFloorName"),J.$off("pushAddVacantSwitchStatus"),J.$off("mappingEmployeeToVacant"),J.$off("pushAllFloorList"),J.$off("pushManagerFloorList"),J.$off("changeSeatToVacant"),J.$off("pushAllImageMap"),J.$off("showSeatHighlight"),J.$off("pushDeletedFloorId")},methods:{initializing:function(){var e=this;if(null==this.floorCanvas){var t=this.$refs.canvas;this.floorCanvas=new fabric.Canvas(t,{fireRightClick:!0,fireMiddleClick:!0,stopContextMenu:!0}),this.floorCanvas.on("mouse:wheel",function(t){if(e.floorCanvas.viewportTransform){var o=t.e,a=o.deltaY;e.zoom=e.floorCanvas.getZoom(),e.zoom=e.zoom-a/300,!0===o.ctrlKey?(e.zoom>10?e.zoom=10:e.zoom<1&&(e.zoom=1),e.floorCanvas.zoomToPoint(new fabric.Point(o.offsetX,o.offsetY),e.zoom)):(e.floorCanvas.setViewportTransform([1,0,0,1,0,0]),e.zoom=1),e.checkZoom(),t.e.preventDefault(),t.e.stopPropagation()}}),this.floorCanvas.on("object:moving",function(e){var t=e.target;t.currentHeight>t.canvas.height||t.currentWidth>t.canvas.width||(t.setCoords(),(t.getBoundingRect().top<0||t.getBoundingRect().left<0)&&(t.top=Math.max(t.top,t.top-t.getBoundingRect().top),t.left=Math.max(t.left,t.left-t.getBoundingRect().left)),(t.getBoundingRect().top+t.getBoundingRect().height>t.canvas.height||t.getBoundingRect().left+t.getBoundingRect().width>t.canvas.width)&&(t.top=Math.min(t.top,t.canvas.height-t.getBoundingRect().height+t.top-t.getBoundingRect().top),t.left=Math.min(t.left,t.canvas.width-t.getBoundingRect().width+t.left-t.getBoundingRect().left)))});var o=0,a=0,l=0,r=0,s=0,n=0;this.floorCanvas.on("object:scaling",function(e){var t=e.target;t.setCoords();var i=t.getBoundingRect();i.width+i.left>=t.canvas.width||i.height+i.top>=t.canvas.height||i.left<0||i.top<0?(t.left=o,t.top=a,t.scaleX=l,t.scaleY=r,t.width=s,t.height=n):(o=t.left,a=t.top,l=t.scaleX,r=t.scaleY,s=t.width,n=t.height)}),this.floorCanvas.on("mouse:down",function(t){if(3===t.button)if(e.addVacantSwitchStatus){var o=e.floorCanvas.getPointer(t.e);e.firstMouseDownX=o.x,e.firstMouseDownY=o.y,console.log(e.firstMouseDownX),console.log(e.firstMouseDownY)}else if(e.floorCanvas.getActiveObject()){var a=t.e.clientX,l=t.e.clientY;e.showContextMenuOfOneSeat(a,l)}}),this.floorCanvas.on("mouse:up",function(t){if(3===t.button&&e.addVacantSwitchStatus){var o=e.floorCanvas.getPointer(t.e),a=o.x,l=o.y;if(console.log(a),console.log(l),console.log("mouseup"),e.firstMouseDownX===a&&e.firstMouseDownY===l)return;if(!e.allImageMap.get(e.currentSelectedFloorId))return void alert("도면 이미지가 없습니다");if(""==e.currentSelectedFloorName)return void alert("층 이름이 설정되지 않았습니다.");console.log(e.firstMouseDownX),console.log(e.firstMouseDownY),e.addVacantSeat(e.firstMouseDownX,e.firstMouseDownY,a,l)}}),this.floorCanvas.on("object:modified",function(t){e.floorCanvas.getObjects().forEach(function(e){e.set("modify",!0)})}),this.floorCanvas.on("mouse:over",function(t){var o=t.target;if(null!=o){var a=t.e.clientX,l=t.e.clientY,r=o.toObject(["employeeId","employeeName","employeeDepartment","employeeNumber"]);e.showToolTip(a,l,r.employeeId,r.employeeName,r.employeeDepartment,r.employeeNumber)}}),this.floorCanvas.on("mouse:out",function(t){e.toolTipStatus=!1}),this.manageKeyboard()}},clickResetToRatioBtn:function(){this.floorCanvas.setViewportTransform([1,0,0,1,0,0])},checkZoom:function(){var e=this,t=this.zoom;5<=t&&t<=7?this.floorCanvas.getObjects().forEach(function(o){o.employeeName&&(o.item(1).text=o.employeeName,o.item(1).fontSize=parseInt(e.fontSize/t))}):7<t&&t<=10?this.floorCanvas.getObjects().forEach(function(o){o.employeeName&&(o.item(1).text=o.employeeName+"\n"+o.employeeNumber,o.item(1).fontSize=parseInt(e.fontSize/t))}):this.floorCanvas.getObjects().forEach(function(o){o.item(1).text="",o.item(1).fontSize=parseInt(e.fontSize/t)})},changeFloor:function(){var e=this;this.floorCanvas.getObjects().slice().forEach(function(t){e.floorCanvas.remove(t)}),this.floorCanvas.discardActiveObject();var t=this.getEachFloorSeatList(this.currentSelectedFloorId);this.getManagerEachFloorSeatList(this.currentSelectedFloorId);if(this.seatNumber=0,null!=this.allImageMap.get(this.currentSelectedFloorId)){if("string"==typeof this.allImageMap.get(this.currentSelectedFloorId)?this.loadImageUrl(this.allImageMap.get(this.currentSelectedFloorId)):this.loadImageFile(this.allImageMap.get(this.currentSelectedFloorId)),t){for(var o=0;o<t.length;o++)this.floorCanvas.add(t[o]);J.$emit("pushAllSeatMap",this.allSeatMap)}}else null==this.allImageMap.get(this.currentSelectedFloorId)&&(this.floorCanvas.getObjects().slice().forEach(function(t){e.floorCanvas.remove(t)}),this.floorCanvas.backgroundImage=0,this.floorCanvas.backgroundColor="aliceblue",this.floorCanvas.renderAll(),J.$emit("pushAllSeatMap",this.allSeatMap))},loadImageFile:function(e){var t=this,o=new FileReader;o.onload=function(e){t.loadImageUrl(e.target.result)},o.readAsDataURL(e)},loadImageUrl:function(e){var t=this;fabric.Image.fromURL(e,function(e){e.set({scaleX:t.floorCanvas.width/e.width,scaleY:t.floorCanvas.height/e.height}),t.floorCanvas.setBackgroundImage(e,t.floorCanvas.renderAll.bind(t.floorCanvas))},{crossOrigin:"Anonymous"})},getEachFloorSeatList:function(e){if(e){if(this.allSeatMap.get(e))return this.allSeatMap.get(e);return this.allSeatMap.set(e,[]),this.allSeatMap.get(e)}},getManagerEachFloorSeatList:function(e){if(e){if(this.managerAllSeatMap.get(e))return this.managerAllSeatMap.get(e);return this.managerAllSeatMap.set(e,[]),this.managerAllSeatMap.get(e)}},getEachEmployeeSeatList:function(e){if(this.eachEmployeeSeatMap.get(e))return this.eachEmployeeSeatMap.get(e);return this.eachEmployeeSeatMap.set(e,[]),this.eachEmployeeSeatMap.get(e)},deleteManagerEachFloorSeatList:function(e){for(var t=this.getManagerEachFloorSeatList(e),o=0;o<t.length;o++)t[o].set("delete",!0)},deleteEachEmployeeSeatList:function(e){if(null!=e.employeeId){var t=this.getEachEmployeeSeatList(e.employeeId);if(t)for(var o=0;o<t.length;o++)t[o].seatId===e.seatId&&t.splice(o,1)}},manageKeyboard:function(){var e=this,t=!1;document.addEventListener("keydown",function(o){var a=window.event?window.event.keyCode:o.keyCode;switch(a){case 17:t=!0,console.log("ctrl true");break;case 37:e.floorCanvas.getActiveObject()&&(e.floorCanvas.getActiveObject().set("left",e.floorCanvas.getActiveObject().left-5),e.floorCanvas.getActiveObject().set("modify",!0),e.floorCanvas.renderAll());break;case 39:e.floorCanvas.getActiveObject()&&(e.floorCanvas.getActiveObject().set("left",e.floorCanvas.getActiveObject().left+5),e.floorCanvas.getActiveObject().set("modify",!0),e.floorCanvas.renderAll());break;case 38:e.floorCanvas.getActiveObject()&&(e.floorCanvas.getActiveObject().set("top",e.floorCanvas.getActiveObject().top-5),e.floorCanvas.getActiveObject().set("modify",!0),e.floorCanvas.renderAll());break;case 40:e.floorCanvas.getActiveObject()&&(e.floorCanvas.getActiveObject().set("top",e.floorCanvas.getActiveObject().top+5),e.floorCanvas.getActiveObject().set("modify",!0),e.floorCanvas.renderAll());break;case 110:case 46:e.deleteBtn()}if(t)switch(a){case 67:e.copySelectedSeat();break;case 86:e.pasteSelectedSeat()}}),document.addEventListener("keyup",function(e){switch(window.event?window.event.keyCode:e.keyCode){case 17:t=!1,console.log("ctrl false")}})},createSeatUUID:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)})},getColor:function(e){return null==e?"Gray":"부서1"===e?"orange":"부서2"===e?"yellow":"부서3"===e?"green":void 0},addVacantSeat:function(e,t,o,a){var l=this.getEachFloorSeatList(this.currentSelectedFloorId),r=this.getManagerEachFloorSeatList(this.currentSelectedFloorId),s=new fabric.Rect({width:Math.abs(e-o),height:Math.abs(t-a),fill:this.getColor(null),opacity:1}),n=new fabric.IText("",{left:0,top:s.height/3,fontSize:0,fill:"black"}),i=new fabric.Group([s,n],{seatId:this.createSeatUUID(),floorId:this.currentSelectedFloorId,employeeName:null,employeeDepartment:null,employeeNumber:null,employeeId:null,left:e,top:t,angle:0,create:!0,modify:!1,delete:!1});if(null!=this.currentSelectedFloorName){if(this.getManagerEachFloorSeatList(this.currentSelectedFloorId).length){var c=[];this.getManagerEachFloorSeatList(this.currentSelectedFloorId).forEach(function(e){c.push(e.seatName.split("-")[1])}),this.seatNumber=Math.max.apply(null,c)}this.seatNumber++;var h=this.currentSelectedFloorName+"-"+this.seatNumber,d=new fabric.IText(h,{left:i.item(0).left,top:i.item(0).top-15,fontSize:this.fontSize/this.zoom,fill:"black"});i.seatName=h,i.add(d)}this.floorCanvas.on("object:scaling",function(e){var t=e.target,o=t.getScaledWidth()/t.scaleX,a=t.getScaledHeight()/t.scaleY;t.width=o,t.height=a;t.toObject(["width","height","scaleX","scaleY"])}),this.floorCanvas.add(i),this.floorCanvas.renderAll(),this.floorCanvas.setActiveObject(i),l.push(i),r.push(i),J.$emit("pushAllSeatMap",this.allSeatMap)},mappingEmployeeToVacant:function(e){var t=this;if(this.floorCanvas.getActiveObject()){var o=[];if(this.floorCanvas.getActiveObjects().forEach(function(t){t.employeeId&&t.employeeId!=e.employeeId&&o.push(t.seatName)}),o.forEach(function(e){console.log(e)}),!(o.length>0)||confirm("선택된 좌석 중 "+o.join(", ")+"자리에 다른 사원이 매핑되어 있습니다.\n변경하시겠습니까?")){var a=this.getEachEmployeeSeatList(e.employeeId);this.floorCanvas.getActiveObjects().forEach(function(o){if(o.employeeId&&o.employeeId!=e.employeeId){var l=o.toObject(["seatId","employeeId"]);t.deleteEachEmployeeSeatList(l)}o.employeeName=e.name,o.employeeDepartment=e.department,o.employeeNumber=e.number,o.employeeId=e.employeeId,o.item(0).set("fill",t.getColor(o.employeeDepartment)),o.set("modify",!0),a.push(o)}),this.checkZoom(),this.floorCanvas.renderAll(),J.$emit("pushAllSeatMap",this.allSeatMap),J.$emit("pushEachEmployeeSeatMap",this.eachEmployeeSeatMap)}}else alert("선택된 좌석이 없습니다.")},clickdeleteAllBtn:function(){var e=this;confirm("Are you sure?")&&(this.floorCanvas.getObjects().slice().forEach(function(t){var o=t.toObject(["seatId","employeeId"]);e.deleteEachEmployeeSeatList(o),e.floorCanvas.remove(t)}),this.getEachFloorSeatList(this.currentSelectedFloorId).length=0,this.deleteManagerEachFloorSeatList(this.currentSelectedFloorId),J.$emit("pushEachEmployeeSeatMap",this.eachEmployeeSeatMap))},deleteBtn:function(){var e=this,t=this.getEachFloorSeatList(this.currentSelectedFloorId);confirm("Are you sure?")&&this.floorCanvas.getActiveObjects().forEach(function(o){o.set("delete",!0);var a=o.toObject(["seatId","employeeId"]);e.deleteEachEmployeeSeatList(a),console.log(e.eachEmployeeSeatMap),console.log(t);var l=t.indexOf(o);t.splice(l,1),console.log(t),e.floorCanvas.remove(o),J.$emit("pushEachEmployeeSeatMap",e.eachEmployeeSeatMap)})},changeSeatToVacant:function(){var e=this;confirm("자리를 비우시겠습니까?")&&(this.floorCanvas.getActiveObjects().forEach(function(t){var o=t.toObject(["seatId","employeeId"]);e.deleteEachEmployeeSeatList(o),t.set("modify",!0),t.set("employeeName",null),t.set("employeeDepartment",null),t.set("employeeNumber",null),t.set("employeeId",null),t.item(0).set("fill",e.getColor(t.employeeDepartment)),e.floorCanvas.remove(t.item(1)),t.item(1).set("text","")}),this.floorCanvas.renderAll(),J.$emit("pushAllSeatMap",this.allSeatMap),J.$emit("pushEachEmployeeSeatMap",this.eachEmployeeSeatMap))},cloneSeat:function(){this.copySelectedSeat(),this.pasteSelectedSeat()},copySelectedSeat:function(){var e=this;this.floorCanvas.getActiveObject()&&(this.floorCanvas.getActiveObject().clone(function(t){e.clipboard=t}),this.clipboard.remove(this.clipboard.item(2)))},pasteSelectedSeat:function(){var e=this;if(this.floorCanvas.getActiveObject()){var t=this.floorCanvas.getActiveObject(),o=this.getEachFloorSeatList(this.currentSelectedFloorId),a=this.getManagerEachFloorSeatList(this.currentSelectedFloorId),l=this.getEachEmployeeSeatList(this.floorCanvas.getActiveObject().employeeId);this.clipboard.clone(function(r){e.floorCanvas.discardActiveObject(),r.set({left:r.left+10,top:r.top+10,create:!0,delete:!1,modify:!1,seatId:e.createSeatUUID(),floorId:e.currentSelectedFloorId,angle:t.angle,employeeDepartment:t.employeeDepartment,employeeId:t.employeeId,employeeName:t.employeeName,employeeNumber:t.employeeNumber,evented:!0});var s=[];e.getManagerEachFloorSeatList(e.currentSelectedFloorId).forEach(function(e){s.push(e.seatName.split("-")[1])}),e.seatNumber=Math.max.apply(null,s),e.seatNumber++,r.seatName=e.currentSelectedFloorName+"-"+e.seatNumber;var n=new fabric.IText(r.seatName,{left:r.item(0).left,top:r.item(0).top-15,fontSize:e.fontSize/e.zoom,fill:"black"});r.add(n),"activeSelection"===r.type?(r.canvas=e.floorCanvas,r.forEachObject(function(e){this.floorCanvas.add(e)}),r.setCoords()):e.floorCanvas.add(r),e.clipboard.top+=10,e.clipboard.left+=10,e.floorCanvas.setActiveObject(r),e.floorCanvas.requestRenderAll(),o.push(r),a.push(r),l.push(r)}),J.$emit("pushAllSeatMap",this.allSeatMap),J.$emit("pushEachEmployeeSeatMap",this.eachEmployeeSeatMap)}},showContextMenuOfOneSeat:function(e,t){var o=this;this.contextMenuStatus=!1,this.contextMenuXLocation=e+10,this.contextMenuYLocation=t,this.$nextTick(function(){o.contextMenuStatus=!0})},clickContextMenu:function(e){switch(e){case 0:this.deleteBtn();break;case 1:this.cloneSeat()}},showToolTip:function(e,t,o,a,l,r){this.toolTipXLocation=e,this.toolTipYLocation=t,null==o?(this.toolTipText="공석",this.toolTipColor=null):(this.toolTipText="이름 : "+a+"<br>아이디 : "+o+"<br>부서 : "+l+"<br>내선번호 : "+r,this.toolTipColor="pink lighten-2"),this.toolTipStatus=!0},moveSeatToAnotherFloor:function(e){var t=this;if(this.floorCanvas.getActiveObject())for(var o=this.getEachFloorSeatList(this.currentSelectedFloorId),a=this.getEachFloorSeatList(this.currentSelectedFloorId),l=function(l){t.allFloorList[l].floorId===e&&(t.floorCanvas.getActiveObjects().forEach(function(e){e.set("floorId",t.allFloorList[l].floorId),e.set("floorName",t.allFloorList[l].floorName),e.set("modify",!0);var r=t.getEachFloorSeatList(t.allFloorList[l].floorId),s=t.getManagerEachFloorSeatList(t.allFloorList[l].floorId);r.push(e),s.push(e);for(var n=0;n<o.length;n++)o[n].seatId===e.seatId&&o.splice(n,1);for(var i=0;i<a.length;i++)a[i].seatId===e.seatId&&a[i].set("delete",!0);J.$emit("pushFloorOfSeat",t.allFloorList[l].floorId),J.$emit("pushEachEmployeeSeatMap",t.eachEmployeeSeatMap)}),t.floorCanvas.renderAll())},r=0;r<this.allFloorList.length;r++)l(r);else alert("이동할 좌석이 선택되지 않았습니다.")},showSeatHighlight:function(e){var t=this,o=null;o=this.currentSelectedFloorId!=e.floorId?e.floorId:this.currentSelectedFloorId;for(var a=this.getEachFloorSeatList(o),l=function(l){var r=a[l],s=r.toObject(["employeeId","floorId","seatId","employeeDepartment"]),n=s.seatId;if(e.seatId==n){if(t.floorCanvas.getObjects().slice().forEach(function(e){t.floorCanvas.remove(e)}),null!=t.allImageMap.get(o)){"string"==typeof t.allImageMap.get(t.currentSelectedFloorId)?t.loadImageUrl(t.allImageMap.get(t.currentSelectedFloorId)):t.loadImageFile(t.allImageMap.get(t.currentSelectedFloorId));for(var i=0;i<a.length;i++)t.floorCanvas.add(a[i])}r.item(0).set("opacity",0),r.item(0).set("stroke","blue"),r.item(0).set("strokeWidth",5),r.item(0).animate("opacity",1,{duration:2e3,onChange:t.floorCanvas.renderAll.bind(t.floorCanvas)}),r.item(0).animate("fill","red",{onChange:t.floorCanvas.renderAll.bind(t.floorCanvas),duration:2e3,onComplete:function(){r.item(0).set("opacity",1),r.item(0).set("fill",c),r.item(0).set("stroke",null),r.item(0).set("strokeWidth",null)}});var c=t.getColor(s.employeeDepartment)}},r=0;r<a.length;r++)l(r)},clickExportToCSVBtn:function(){var e=this.currentSelectedFloorId;this.$emit("downloadCSVFile",e)},changeCSVFile:function(e){var t=e.target.files||e.dataTransfer.files;t.length&&this.saveFromCSVFileToDB(t[0])},saveFromCSVFileToDB:function(e){var t=new File([e],e.name,{type:"text/csv"});console.log(t);var o=this.currentSelectedFloorId,a=new FormData;a.append("file",t),this.$emit("saveFromCSVFileToDB",a,o)},clickSaveBtn:function(){if(this.floorCanvas.discardActiveObject(),this.managerFloorList){for(var e=0;e<this.managerFloorList.length;e++)if(this.managerFloorList[e].create){if(this.managerFloorList[e].delete)continue;var t={};t.floor_id=this.managerFloorList[e].floorId,t.floor_name=this.managerFloorList[e].floorName,t.building_id=this.managerFloorList[e].buildingId,t.floor_order=this.managerFloorList[e].floorOrder,this.$emit("saveFloors","floors",t)}else if(this.managerFloorList[e].delete){var o=this.managerFloorList[e].floorId;this.$emit("deleteFloorWithKey","floors",o)}else if(this.managerFloorList[e].modify){var a={};a.floor_id=this.managerFloorList[e].floorId,a.floor_name=this.managerFloorList[e].floorName,a.building_id=this.managerFloorList[e].buildingId,a.floor_order=this.managerFloorList[e].floorOrder,this.$emit("saveFloors","floors",a)}for(var l=0;l<this.managerFloorList.length;l++){var r=new FormData,s=this.managerFloorList[l].floorId,n=this.allImageMap.get(s);null!=n&&("string"==typeof n||(r.append("imageFile",n),this.$emit("saveImages","images",r,s)))}for(var i=0;i<this.managerFloorList.length;i++){var c=this.getManagerEachFloorSeatList(this.managerFloorList[i].floorId);if(c.length>0)for(var h=0;h<c.length;h++){var d=c[h].toObject(["seatId","seatName","floorId","left","top","employeeDepartment","employeeId","width","height","scaleX","scaleY","create","modify","delete"]);if(d.create){if(d.delete)continue;var p={};p.seat_id=d.seatId,p.seat_name=d.seatName,p.floor=d.floorId,p.x=d.left,p.y=d.top,p.is_group=!1,p.group_id=null,p.building_id="HANCOM01",p.employee_id=d.employeeId,p.width=d.width*d.scaleX,p.height=d.height*d.scaleY,p.degree=d.angle,p.shape_id="1",this.$emit("saveSeats","seats",p,p.floor)}else if(d.delete){var m=d.seatId,u=d.floorId;this.$emit("deleteSeatWithKey","seats",m,u)}else if(d.modify){var f={};f.seat_id=d.seatId,f.seat_name=d.seatName,f.floor=d.floorId,f.x=d.left,f.y=d.top,f.is_group=!1,f.group_id=null,f.building_id="HANCOM01",f.employee_id=d.employeeId,f.width=d.width*d.scaleX,f.height=d.height*d.scaleY,f.degree=d.angle,f.shape_id="1",this.$emit("saveSeats","seats",f,f.floor)}}}}},getEmployeeObject:function(e){for(var t=[],o={},a=0;a<this.employeeList.length;a++){var l={};l.name=this.employeeList[a].name,l.department=this.employeeList[a].department,l.number=this.employeeList[a].number,l.employeeId=this.employeeList[a].employeeId,t.push(l)}if(null==e){var r={name:null,department:null,number:null};o=r}else for(var s=0;s<t.length;s++)e===t[s].employeeId&&(o=t[s]);return o},makeGroupInfo:function(e){var t=this.getEmployeeObject(e.employeeId),o=new fabric.Rect({width:e.width,height:e.height,fill:this.getColor(t.department),opacity:1}),a=new fabric.IText("",{left:0,top:o.height/3,fontSize:0,fill:"black"}),l=new fabric.Group([o,a],{seatId:e.seatId,employeeName:t.name,employeeDepartment:t.department,employeeNumber:t.number,employeeId:e.employeeId,floorId:e.floorId,left:e.x,top:e.y,angle:e.degree,create:e.create,modify:e.modify,delete:e.delete}),r=new fabric.IText(e.seatName,{left:o.left,top:o.top-15,fontSize:this.fontSize/this.zoom,fill:"black"});return l.seatName=e.seatName,l.add(r),this.floorCanvas.on("object:scaling",function(e){var t=e.target,o=t.getScaledWidth()/t.scaleX,a=t.getScaledHeight()/t.scaleY;t.width=o,t.height=a;t.toObject(["width","height","scaleX","scaleY"])}),l},loadLatestFloor:function(){if(this.latestFloorImageFromDb){for(var e=0;e<this.latestFloorImageFromDb.length;e++){var t=this.latestFloorImageFromDb[e].url,o=this.latestFloorImageFromDb[e].floorId;if(this.allImageMap.set(o,t),this.currentSelectedFloorId=o,this.loadImageUrl(t),this.latestFloorSeatListFromDb.length)for(var a=0;a<this.latestFloorSeatListFromDb.length;a++){this.currentSelectedFloorId=this.latestFloorSeatListFromDb[a].floorId;var l=this.getEachFloorSeatList(this.latestFloorSeatListFromDb[a].floorId),r=this.getManagerEachFloorSeatList(this.latestFloorSeatListFromDb[a].floorId),s=this.makeGroupInfo(this.latestFloorSeatListFromDb[a]);if(this.floorCanvas.add(s),l.push(s),r.push(s),J.$emit("pushAllSeatMap",this.allSeatMap),null!=this.latestFloorSeatListFromDb[a].employeeId)this.getEachEmployeeSeatList(this.latestFloorSeatListFromDb[a].employeeId).push(s),J.$emit("pushEachEmployeeSeatMap",this.eachEmployeeSeatMap)}else this.currentSelectedFloorId=o}this.loadOtherFloors()}},loadOtherFloors:function(){if(this.otherFloorSeatListFromDb){for(var e=0;e<this.otherFloorImageFromDb.length;e++){var t=this.otherFloorImageFromDb[e].url,o=this.otherFloorImageFromDb[e].floorId;this.allImageMap.set(o,t)}if(this.otherFloorSeatListFromDb){var a;a=M()(this.otherFloorSeatListFromDb.keys());for(var l=0;l<a.length;l++){var r;r=this.otherFloorSeatListFromDb.get(a[l]);for(var s=0;s<r.length;s++){var n=this.getEachFloorSeatList(r[s].floorId),i=this.getManagerEachFloorSeatList(r[s].floorId),c=this.makeGroupInfo(r[s]);if(n.push(c),i.push(c),null!=r[s].employeeId)this.getEachEmployeeSeatList(r[s].employeeId).push(c),J.$emit("pushEachEmployeeSeatMap",this.eachEmployeeSeatMap);J.$emit("pushAllSeatMap",this.allSeatMap)}}}}},clickPrintBtn:function(){var e=window.open("","","width=1500,height=800"),t="<!DOCTYPE html>";t+="<html>",t+="<head><title>Hnazari</title>",t+="</head>",t+="<body>",t+='<img src="'+document.getElementById("canvas").toDataURL()+'" onload=window.print();window.close();>',t+="</body>",t+="</html>",e.document.write(t)}}},A={render:function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",[o("v-toolbar",{attrs:{color:"black",dark:""}},[o("v-toolbar-title",[e._v(e._s(e.currentSelectedFloorName)+" 층")]),e._v(" "),o("v-spacer"),e._v(" "),o("v-toolbar-items",{staticClass:"hidden-sm-and-down"},[o("v-btn",{attrs:{text:""},on:{click:e.clickdeleteAllBtn}},[o("v-icon",{attrs:{large:""}},[e._v("delete")]),e._v("모든 좌석 삭제")],1),e._v(" "),o("v-divider",{attrs:{vertical:""}}),e._v(" "),o("v-btn",{attrs:{text:""},on:{click:e.clickResetToRatioBtn}},[o("v-icon",{attrs:{large:""}},[e._v("zoom_out")]),e._v(" 배율 초기화\n      ")],1),e._v(" "),o("v-divider",{attrs:{vertical:""}}),e._v(" "),o("v-btn",{attrs:{text:""},on:{click:e.clickSaveBtn}},[o("v-icon",{attrs:{large:""}},[e._v("save")]),e._v(" 저장\n      ")],1),e._v(" "),o("v-divider",{attrs:{vertical:""}}),e._v(" "),o("v-btn",{attrs:{text:""},on:{click:e.clickPrintBtn}},[o("v-icon",{attrs:{large:""}},[e._v("print")]),e._v("프린트\n      ")],1),e._v(" "),o("v-divider",{attrs:{vertical:""}}),e._v(" "),o("v-btn",{attrs:{text:""},on:{click:e.clickExportToCSVBtn}},[o("v-icon",{attrs:{large:""}},[e._v("cloud_download")]),e._v(" CSV 내려받기\n      ")],1),e._v(" "),o("v-divider",{attrs:{vertical:""}}),e._v(" "),o("input",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],ref:"Upload",attrs:{type:"file",accept:".csv, application/vnd.openxmlformats-officedocument.spreadsheetml.sheet, application/vnd.ms-excel"},on:{change:e.changeCSVFile}}),e._v(" "),o("v-btn",{attrs:{text:""},on:{click:function(t){return e.$refs.Upload.click()}}},[o("v-icon",{attrs:{large:""}},[e._v("cloud_upload")]),e._v(" CSV 내용 db 업데이트하기\n      ")],1)],1)],1),e._v(" "),o("canvas",{ref:"canvas",staticClass:"canvas",staticStyle:{"text-align":"center"},attrs:{id:"canvas",height:"770px",width:"1150px"}}),e._v(" "),o("v-menu",{attrs:{"position-x":e.contextMenuXLocation,"position-y":e.contextMenuYLocation,absolute:"","offset-y":"","max-width":"180"},model:{value:e.contextMenuStatus,callback:function(t){e.contextMenuStatus=t},expression:"contextMenuStatus"}},[o("v-list",e._l(e.contextMenuItems,function(t,a){return o("v-list-item",{key:a,on:{click:function(o){return e.clickContextMenu(t.index)}}},[o("v-list-item-title",[e._v(e._s(t.title))])],1)}),1)],1),e._v(" "),o("v-tooltip",{attrs:{top:"","position-x":e.toolTipXLocation,"position-y":e.toolTipYLocation,color:e.toolTipColor},model:{value:e.toolTipStatus,callback:function(t){e.toolTipStatus=t},expression:"toolTipStatus"}},[o("span",{domProps:{innerHTML:e._s(e.toolTipText)}})])],1)},staticRenderFns:[]};var N="172.30.1.53",$={name:"Hanzari",components:{Tabs:o("VU/8")(k,O,!1,null,null,null).exports,AssignSeats:o("VU/8")(T,A,!1,function(e){o("xgBC")},"data-v-2a875ccc",null).exports,MappingEmployee:F},data:function(){return{drawer:null,employeeList:null,floorList:null,floorIdList:[],latestFloor:null,latestFloorImage:null,otherFloorsImageList:null,latestFloorSeatList:null,otherFloorsSeatMap:null}},created:function(){var e=this;return f()(m.a.mark(function t(){return m.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.getEmployeeList();case 2:return e.employeeList=t.sent,t.next=5,e.getFloorList();case 5:return e.floorList=t.sent,t.next=8,e.getLatestFloor();case 8:return e.latestFloor=t.sent,t.next=11,e.getLatestFloorImage();case 11:return e.latestFloorImage=t.sent,t.next=14,e.getLatestFloorSeatList();case 14:return e.latestFloorSeatList=t.sent,t.next=17,e.getOtherFloorImageList();case 17:return e.otherFloorsImageList=t.sent,t.next=20,e.getOtherFloorsSeatMap();case 20:e.otherFloorsSeatMap=t.sent;case 21:case"end":return t.stop()}},t,e)}))()},methods:{getEmployeeList:function(){var e=this;return f()(m.a.mark(function t(){var o,a,l,s;return m.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return o=[],e.prev=1,e.next=4,r.a.get("http://"+N+":8081/api/employee");case 4:for(a=e.sent,l=0;l<a.data.length;l++)(s={}).name=a.data[l].employee_name,s.department=a.data[l].department_name,s.number=a.data[l].extension_number,s.employeeId=a.data[l].employee_id,s.seatIdList=a.data[l].seatList,o.push(s);e.next=11;break;case 8:e.prev=8,e.t0=e.catch(1),console.log(e.t0);case 11:return e.abrupt("return",o);case 12:case"end":return e.stop()}},t,e,[[1,8]])}))()},getFloorList:function(){var e=this;return f()(m.a.mark(function t(){var o,a,l,s,n;return m.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return o=[],t.prev=1,t.next=4,r.a.get("http://"+N+":8081/api/buildings/HANCOM01/floors");case 4:for(a=t.sent,l=0;l<a.data.length;l++)(s={}).floorId=a.data[l].floor_id,s.floorName=a.data[l].floor_name,s.buildingId=a.data[l].building_id,s.floorOrder=a.data[l].floor_order,s.create=!1,s.modify=!1,s.delete=!1,o.push(s);for(o.sort(function(e,t){return e.floorOrder<t.floorOrder?-1:e.floorOrder>t.floorOrder?1:0}),n=0;n<o.length;n++)e.floorIdList.push(o[n].floorId);t.next=13;break;case 10:t.prev=10,t.t0=t.catch(1),console.log(t.t0);case 13:return t.abrupt("return",o);case 14:case"end":return t.stop()}},t,e,[[1,10]])}))()},getLatestFloor:function(){var e=this;return f()(m.a.mark(function t(){var o,a;return m.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return o=null,e.prev=1,e.next=4,r.a.get("http://"+N+":8081/api/buildings/HANCOM01/floors/get-latest-floor");case 4:a=e.sent,o=a.data,e.next=11;break;case 8:e.prev=8,e.t0=e.catch(1),console.log(e.t0);case 11:return e.abrupt("return",o);case 12:case"end":return e.stop()}},t,e,[[1,8]])}))()},getLatestFloorImage:function(){var e=this;return f()(m.a.mark(function t(){var o,a,l,s;return m.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(o=[],!e.latestFloor){t.next=17;break}if(null==(a=e.latestFloor.floor_id)){t.next=17;break}return t.prev=4,t.next=7,r.a.get("http://"+N+":8081/api/buildings/HANCOM01/floors/"+a+"/images");case 7:l=t.sent,(s={}).url=l.config.url,s.floorId=a,o.push(s),t.next=17;break;case 14:t.prev=14,t.t0=t.catch(4),console.log(t.t0);case 17:return t.abrupt("return",o);case 18:case"end":return t.stop()}},t,e,[[4,14]])}))()},getOtherFloorImageList:function(){var e=this;return f()(m.a.mark(function t(){var o,a,l,s,n;return m.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(o=[],a=null,!(e.floorIdList.length>0)){t.next=22;break}t.prev=3,l=0;case 5:if(!(l<e.floorIdList.length-1)){t.next=17;break}return t.next=8,r.a.get("http://"+N+":8081/api/buildings/HANCOM01/floors/"+e.floorIdList[l]+"/images");case 8:s=t.sent,(n={}).url=s.config.url,n.floorId=e.floorIdList[l],a=n,o.push(a);case 14:l++,t.next=5;break;case 17:t.next=22;break;case 19:t.prev=19,t.t0=t.catch(3),console.error(t.t0);case 22:return t.abrupt("return",o);case 23:case"end":return t.stop()}},t,e,[[3,19]])}))()},getLatestFloorSeatList:function(){var e=this;return f()(m.a.mark(function t(){var o,a,l,s,n;return m.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(o=[],!e.latestFloor){t.next=13;break}return a=e.latestFloor.floor_id,t.prev=3,t.next=6,r.a.get("http://"+N+":8081/api/buildings/HANCOM01/floors/"+a+"/seats");case 6:for(l=t.sent,s=0;s<l.data.length;s++)(n={}).seatId=l.data[s].seat_id,n.seatName=l.data[s].seat_name,n.floorId=l.data[s].floor,n.x=l.data[s].x,n.y=l.data[s].y,n.isGroup=l.data[s].is_group,n.buildingId=l.data[s].building_id,n.employeeId=l.data[s].employee_id,n.width=l.data[s].width,n.height=l.data[s].height,n.degree=l.data[s].degree,n.shapeId=l.data[s].shape_id,n.create=!1,n.delete=!1,n.modify=!1,o.push(n);t.next=13;break;case 10:t.prev=10,t.t0=t.catch(3),console.log(t.t0);case 13:return t.abrupt("return",o);case 14:case"end":return t.stop()}},t,e,[[3,10]])}))()},getOtherFloorsSeatMap:function(){var e=this;return f()(m.a.mark(function t(){var o,a,l,s,n,i;return m.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:o=new d.a,t.prev=1,a=0;case 3:if(!(a<e.floorIdList.length-1)){t.next=12;break}return t.next=6,r.a.get("http://"+N+":8081/api/buildings/HANCOM01/floors/"+e.floorIdList[a]+"/seats");case 6:if(l=t.sent,s=[],0===l.data.length)o.set(e.floorIdList[a],[]);else for(n=0;n<l.data.length;n++)(i={}).seatId=l.data[n].seat_id,i.seatName=l.data[n].seat_name,i.floorId=l.data[n].floor,i.x=l.data[n].x,i.y=l.data[n].y,i.isGroup=l.data[n].is_group,i.buildingId=l.data[n].building_id,i.employeeId=l.data[n].employee_id,i.width=l.data[n].width,i.height=l.data[n].height,i.degree=l.data[n].degree,i.shapeId=l.data[n].shape_id,i.create=!1,i.delete=!1,i.modify=!1,s.push(i),e.floorIdList[a]===l.data[n].floor&&o.set(e.floorIdList[a],s);case 9:a++,t.next=3;break;case 12:t.next=17;break;case 14:t.prev=14,t.t0=t.catch(1),console.error(t.t0);case 17:return t.abrupt("return",o);case 18:case"end":return t.stop()}},t,e,[[1,14]])}))()},saveFloors:function(e,t){var o=t,a=e;try{r.a.post("http://"+N+":8081/api/buildings/HANCOM01/"+a,c()(o),{headers:{"Content-Type":"application/json"}})}catch(e){console.error(e)}},saveImages:function(e,t,o){var a=t;try{r.a.post("http://"+N+":8081/api/buildings/HANCOM01/floors/"+o+"/"+e,a,{headers:{"Content-Type":"multipart/form-data"}})}catch(e){console.error(e)}},saveSeats:function(e,t,o){var a=t,l=e;try{r.a.post("http://"+N+":8081/api/buildings/HANCOM01/floors/"+o+"/"+l,c()(a),{headers:{"Content-Type":"application/json"}})}catch(e){console.error(e)}},deleteFloorWtihKey:function(e,t){var o=e,a=t;try{r.a.delete("http://"+N+":8081/api/buildings/HANCOM01/"+o+"/"+a)}catch(e){console.error(e)}},deleteSeatWithKey:function(e,t,o){var a=e,l=t;try{r.a.delete("http://"+N+":8081/api/buildings/HANCOM01/floors/"+o+"/"+a+"/"+l)}catch(e){console.error(e)}},downloadCSVFile:function(e){var t=this;return f()(m.a.mark(function o(){var a,l,s,i,c,h,d,p,u,f;return m.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,r.a.get("http://"+N+":8081/api/buildings/HANCOM01/floors/"+e+"/seats/get-csv-file-allfloor-seats",{headers:{"Content-Type":"text/csv"}});case 3:a=t.sent,l=window.URL.createObjectURL(new Blob([a.data])),s=document.createElement("a"),i=a.headers["content-disposition"],c=null,i&&(h=i.split(";").filter(function(e){return e.includes("filename")}),d=n()(h,1),(p=d[0])&&(u=p.split("="),f=n()(u,2),c=f[1])),s.href=l,s.setAttribute("download",""+c),s.style.cssText="display:none",document.body.appendChild(s),s.click(),s.remove(),t.next=20;break;case 17:t.prev=17,t.t0=t.catch(0),console.log(t.t0);case 20:case"end":return t.stop()}},o,t,[[0,17]])}))()},saveFromCSVFileToDB:function(e,t){r.a.post("http://"+N+":8081/api/buildings/HANCOM01/floors/"+t+"/seats/update-by-file",e,{headers:{"Content-Type":"multipart/form-data"}}).then(function(e){console.log(e)}).catch(function(e){console.log(e)})}}},j={render:function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("v-app",{attrs:{id:"app"}},[o("div",{staticClass:"hanzari",attrs:{id:"hanzari"}},[o("v-app-bar",{attrs:{app:"",dark:""}},[o("v-toolbar",{attrs:{color:"black",dark:""}},[o("v-spacer",[o("v-toolbar-items",[e.drawer?o("v-icon",{attrs:{large:"",dark:""},on:{click:function(t){e.drawer=!e.drawer}}},[e._v("keyboard_arrow_left")]):e._e(),e._v(" "),e.drawer?e._e():o("v-icon",{attrs:{large:"",dark:""},on:{click:function(t){e.drawer=!e.drawer}}},[e._v("keyboard_arrow_right")])],1)],1),e._v(" "),o("v-toolbar-title",[e._v("한자리")])],1)],1),e._v(" "),o("v-navigation-drawer",{attrs:{app:"",width:500},model:{value:e.drawer,callback:function(t){e.drawer=t},expression:"drawer"}},[e.employeeList&&e.floorList&&e.latestFloorImage&&e.otherFloorsImageList?o("Tabs",{attrs:{copyEmployeeList:e.employeeList,copyFloorList:e.floorList,copyLatestFloorImage:e.latestFloorImage,copyOtherFloorsImageList:e.otherFloorsImageList}}):e._e()],1),e._v(" "),o("v-main",[e.employeeList&&e.floorList&&e.latestFloorImage&&e.latestFloorSeatList&&e.otherFloorsImageList&&e.otherFloorsSeatMap?o("AssignSeats",{attrs:{copyEmployeeList:e.employeeList,copyFloorList:e.floorList,copyLatestFloorImage:e.latestFloorImage,copyOtherFloorsImageList:e.otherFloorsImageList,copyLatestFloorSeatList:e.latestFloorSeatList,copyOtherFloorsSeatMap:e.otherFloorsSeatMap},on:{saveImages:e.saveImages,saveFloors:e.saveFloors,saveSeats:e.saveSeats,deleteFloorWithKey:e.deleteFloorWtihKey,deleteSeatWithKey:e.deleteSeatWithKey,downloadCSVFile:e.downloadCSVFile,saveFromCSVFileToDB:e.saveFromCSVFileToDB}}):e._e()],1)],1)])},staticRenderFns:[]},D=o("VU/8")($,j,!1,null,null,null).exports,V={name:"App",components:{Hanzari:D}},B={render:function(){var e=this.$createElement;return(this._self._c||e)("Hanzari")},staticRenderFns:[]},z=o("VU/8")(V,B,!1,null,null,null).exports,H=o("/ocq"),R=o("tsU9"),U=o.n(R),Y={render:function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("v-app",{attrs:{id:"app"}},[o("v-app-bar",{attrs:{app:"",dark:""}},[o("v-toolbar",{attrs:{color:"black",dark:""}},[o("v-spacer"),e._v(" "),o("v-toolbar-title",[e._v("Hanzari Login")])],1)],1),e._v(" "),o("v-main",[o("v-container",{staticClass:"text-xs-center",staticStyle:{position:"relative",top:"20%"}},[o("v-layout",{staticClass:"text-xs-center",attrs:{row:"",wrap:""}},[o("v-flex",[o("v-card",{staticClass:"mx-auto",attrs:{flat:"","max-width":"800"}},[o("v-card-title",{attrs:{"primary-title":""}},[o("h4",[e._v("Login")])]),e._v(" "),o("v-form",[o("v-text-field",{attrs:{"prepend-icon":"person",name:"Employee ID",label:"Employee ID"}}),e._v(" "),o("v-text-field",{attrs:{"prepend-icon":"lock",name:"Password",label:"Password",type:"password"}}),e._v(" "),o("v-card-actions",[o("v-btn",{attrs:{primary:"",large:"",block:""}},[e._v("Login")])],1)],1)],1)],1)],1)],1)],1)],1)},staticRenderFns:[]},X=o("VU/8")({},Y,!1,null,null,null).exports;a.default.use(H.a),a.default.use(U.a);var P=new H.a({mode:"history",routes:[{path:"/",name:"login",component:X},{path:"/Hanzari",name:"Hanzari",component:D}]}),W=o("3EgV"),K=o.n(W),G=(o("7zck"),o("NPud")),Z=o.n(G);o.d(t,"eventBus",function(){return J});var J=new a.default;a.default.prototype.$axios=r.a,a.default.use(K.a,{iconfont:"mdi"}),a.default.use(Z.a),new a.default({el:"#app",router:P,components:{App:z},template:"<App/>",vuetify:new K.a})},gJtD:function(e,t){},xgBC:function(e,t){}},["NHnr"]);
//# sourceMappingURL=app.375747c7b869cd836ba2.js.map